<div ng-controller="userCtrl as user">

  <div class="row">
    <div class="col-sm-5">
      <md-content>
        <h2>New project</h2>
        <p><input class="form-control" type="text" ng-model="user.project.name" placeholder="Name"></p>
        <p>Deadline
          <md-datepicker ng-model="user.project.deadline" md-placeholder="Enter deadline"
                         md-open-on-focus=""></md-datepicker>
        </p>
        <p><input type="checkbox" ng-model="user.project.deadlineremind"> Remind me of deadline </p>
        <p><input type="checkbox" ng-model="user.project.private"> Private project</p>
      </md-content>
    </div>
    <div class="col-sm-5 well">

      <div class="row-stats" aria-label="The estimate is based on the costs of the currently unfinished tasks.">
        <b>€{{user.calcEstimatedCost()}}</b>
        <em>Estimated cost <i class="glyphicon glyphicon-question-sign"><md-tooltip>The estimate is based on the costs of the currently unfinished tasks.</md-tooltip></i></em>
      </div>
      <div class="row-stats" aria-label="The estimate is based on the times of the currently unfinished tasks.">
        <b>{{user.calcEstimatedTime()}} hours</b>
        <em>Estimated time needed <i class="glyphicon glyphicon-question-sign"><md-tooltip>The estimate is based on the times of the currently unfinished tasks.</md-tooltip></i></em>
      </div>
    </div>
  </div>

  <!--
    Chips
  -->
  <div data-ng-init="user.getArmorChips()">
    <h4>Use pre-made templates <i class="glyphicon glyphicon-question-sign"><md-tooltip>These templates will generate relevant tasks and add needed material. You can then edit as you see fit.</md-tooltip></i></h4>
    <div data-ng-init="user.getMaterials()">
      <md-chips readonly="true" class="custom-chips" ng-model="armorChips">
        <md-chip-template>
            <span ng-click="user.addChipToProject($chip)">
              <strong>{{$chip.name}}</strong>
              <em>({{$chip.mainmaterial}})</em>
            </span>
        </md-chip-template>
      </md-chips>
    </div>
  </div>

  <!--
    Task list
  -->
  <h3>Task list</h3>
  <em class="info-block">The tasks you add to the project will help you get an estimation on your project. After you've started your new project you are free to edit them as you see fit, to make sure your list is as accurate as possible. This will help you in estimating future projects.</em>
  <div>
    <table class="table table-striped">
      <thead>
      <tr>
        <th>Task</th>
        <th>Estimated time</th>
        <th>Estimated cost</th>
        <th>Finished?</th>
        <th>Delete?</th>
      </tr>
      </thead>
      <tbody>
      <tr ng-repeat="x in user.project.taskList">
        <td ng-cloak data-ng-class="x.finished ? 'strikethrough' : 'null'">{{x.task}}</td>
        <td ng-cloak data-ng-class="x.finished ? 'strikethrough' : 'null'">{{x.time}} hours</td>
        <td ng-cloak data-ng-class="x.finished ? 'strikethrough' : 'null'">€{{x.cost}}</td>
        <td>
          <button type="button" data-ng-class="x.finished ? 'btn btn-danger' : 'btn btn-success'"
                  ng-click="user.toggleDone(x);">
            <i ng-cloak data-ng-class="x.finished ? 'glyphicon glyphicon-remove' : 'glyphicon glyphicon-ok'"></i>
          </button>
        </td>
        <td>
          <button type="button" class="btn btn-danger" ng-click="user.removeTask(x)">
            <i class="glyphicon glyphicon-trash"></i>
          </button>
        </td>
      </tr>
      <tr>
        <td><input class="form-control" type="text" ng-model="taskInput" size="25" placeholder="Task description"></td>
        <td><input class="form-control" type="number" ng-model="taskTime" size="8" placeholder="Hours"></td>
        <td><input class="form-control" type="number" ng-model="taskCost" size="8" placeholder="€"></td>
        <td><input type="submit" value="Add task" class="btn btn-default" ng-click="user.addTask()"></td>
      </tr>
      </tbody>
    </table>

    <!--
    Materials
    -->

    <div id="planningTool">
      <div>
        <h3>Materials</h3>
        <em class="info-block">These materials have no influence on your estimation, but it can help you plan your shopping more efficiently. After your project has started you can edit this list at any point, to make sure the list is as accurate as possible. This will also help you in any future projects.</em>
        <table class="table table-striped">
          <thead>
          <tr>
            <th>Material</th>
            <th>Amount</th>
            <th>Total cost</th>
            <th></th>
            <th></th>
          </tr>
          </thead>

          <tbody>

          <tr ng-repeat="material in user.project.materials">
            <td>
              <span class="col-sm-10" ng-show="!material.editmode">{{material.name}}</span>
              <input class="form-control" type="text" ng-model="material.name" ng-show="material.editmode">
            </td>
            <td>
              <span class="col-sm-2" ng-show="!material.editmode">{{material.amount}} </span>
              <input class="form-control col-sm-2" type="number" ng-model="material.amount" ng-show="material.editmode"><span class="col-sm-4">{{material.quantitytype}}</span></td>
            <td>
              <span class="col-sm-2">€</span>
              <span class="col-sm-2" ng-show="!material.editmode">{{material.cost}}</span>
              <input class="form-control col-sm-2" type="number" ng-model="material.cost" ng-show="material.editmode">
              </td>
            <td><!--<i class="btn btn-default glyphicon glyphicon-pencil" ng-click="user.toggleEditMode(material)"></i>--></td><!-- TODO make editing possible -->
            <td><i class="btn btn-danger glyphicon glyphicon-trash" ng-click="user.removeMaterial(material)"></i></td>
          </tr>

          <tr>
            <td ng-init="user.getMaterials()"><select ng-model="newMaterial" class="btn btn-default col-sm-10"
                                                      ng-options="typeMaterial.name for typeMaterial in materials"></select>
            </td>
            <td><input class="form-control col-sm-3" type="number" ng-model="newMaterial.amount"
                       placeholder="Amount per {{newMaterial.quantitytype}}"></td>
            <td><input class="form-control col-sm-3" type="number" ng-model="newMaterial.cost" placeholder="€"></td>
            <td>
              <button type="button" class="btn btn-success" ng-click="user.addMaterial(newMaterial)"><i
                class="glyphicon glyphicon-plus"></i></button>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
